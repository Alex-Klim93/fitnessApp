(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,85456,e=>{e.v({Directions:"page-module__dXRpxq__Directions",Directions__box:"page-module__dXRpxq__Directions__box",Directions__description:"page-module__dXRpxq__Directions__description",Directions__text:"page-module__dXRpxq__Directions__text",Directions__title:"page-module__dXRpxq__Directions__title",backLink:"page-module__dXRpxq__backLink",entice:"page-module__dXRpxq__entice",entice__dis:"page-module__dXRpxq__entice__dis",entice__disBox:"page-module__dXRpxq__entice__disBox",entice__numb:"page-module__dXRpxq__entice__numb",entice__text:"page-module__dXRpxq__entice__text",entice__title:"page-module__dXRpxq__entice__title",error:"page-module__dXRpxq__error",loading:"page-module__dXRpxq__loading",motivation:"page-module__dXRpxq__motivation",motivation__box:"page-module__dXRpxq__motivation__box",motivation__but:"page-module__dXRpxq__motivation__but",motivation__butLink:"page-module__dXRpxq__motivation__butLink",motivation__img:"page-module__dXRpxq__motivation__img",motivation__imgSvg1:"page-module__dXRpxq__motivation__imgSvg1",motivation__imgSvg2:"page-module__dXRpxq__motivation__imgSvg2",motivation__main:"page-module__dXRpxq__motivation__main",motivation__text:"page-module__dXRpxq__motivation__text",motivation__title:"page-module__dXRpxq__motivation__title",notFound:"page-module__dXRpxq__notFound"})},75852,e=>{e.v({main__box:"SkillCard-module__Jshf6a__main__box",main__image:"SkillCard-module__Jshf6a__main__image",main__title:"SkillCard-module__Jshf6a__main__title"})},40222,e=>{"use strict";var t=e.i(43476),i=e.i(57688),o=e.i(85456),s=e.i(22016),a=e.i(75852);function l({courseName:e="Йога",imageUrl:o="/img/image_9.png",backgroundColor:s="#FF6B6B",imageWidth:l="58%",imageHeight:n="119%",imageTop:d="-230px",imageRight:r="-205px"}){return(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:a.default.main__box,style:{backgroundColor:s},children:[(0,t.jsx)(i.default,{width:500,height:500,className:a.default.main__image,style:{position:"relative",width:l,height:n,top:d,right:r},src:o,alt:e,priority:!0}),(0,t.jsx)("h1",{className:a.default.main__title,children:e})]})})}var n=e.i(71645),d=e.i(18566),r=e.i(90704),c=e.i(32614),_=e.i(11095);function u({params:e}){let[a,u]=(0,n.useState)(null),[m,g]=(0,n.useState)(!0),[p,h]=(0,n.useState)(null),[x,f]=(0,n.useState)(!1),[v,j]=(0,n.useState)(!1),[C,R]=(0,n.useState)(null),[D,w]=(0,n.useState)(""),[y,N]=(0,n.useState)(!1),[S,b]=(0,n.useState)(!1),q=(0,d.useRouter)(),A=(0,d.useSearchParams)(),X=A?.get("imageUrl"),U=A?.get("backgroundColor"),I=A?.get("imageWidth"),k=A?.get("imageHeight"),E=A?.get("imageTop"),B=A?.get("imageRight");(0,n.useEffect)(()=>{(async()=>{let{id:t}=await e;w(t),console.log("ID курса из URL:",t)})()},[e]);let L=(0,n.useCallback)(async()=>{try{if(!(0,r.isAuthenticated)()||!D)return console.log("Пользователь не авторизован или нет ID курса"),{userData:null,isCourseAdded:!1};console.log("Загружаю данные пользователя для проверки курса...");let e=await (0,c.getCurrentUser)();console.log("Полный ответ от getCurrentUser():",JSON.stringify(e,null,2));let t=[];e&&"user"in e&&e.user?(t=e.user.selectedCourses||[],console.log("Нашли курсы в user.user.selectedCourses:",t)):e&&"selectedCourses"in e?(t=e.selectedCourses||[],console.log("Нашли курсы в user.selectedCourses:",t)):Array.isArray(e)?(t=e,console.log("Ответ - это массив курсов:",t)):console.log("Неизвестная структура ответа"),console.log("Курсы пользователя после обработки:",t),console.log("Ищем курс с ID:",D);let i=t.includes(D);return console.log("Результат проверки курса:",{courseId:D,isAdded:i,foundIndex:t.indexOf(D),userCourses:t}),{userData:e,isCourseAdded:i}}catch(e){return console.error("Ошибка загрузки данных пользователя:",e),e instanceof Error&&e.message.includes("401")&&(localStorage.removeItem("auth_token"),window.dispatchEvent(new Event("authStateChanged"))),{userData:null,isCourseAdded:!1}}},[D]);(0,n.useEffect)(()=>{let e=async()=>{try{if(g(!0),h(null),!D)return;console.log("=== НАЧАЛО ЗАГРУЗКИ СТРАНИЦЫ КУРСА ==="),console.log("ID курса для загрузки:",D),console.log("Загружаю данные курса...");let e=await (0,c.getCourseById)(D);u(e),console.log("Данные курса загружены:",{id:e._id,name:e.nameRU});let t=(0,r.isAuthenticated)();if(console.log("Пользователь авторизован:",t),t){let{userData:t,isCourseAdded:i}=await L();if(R(t),b(i),console.log("=== РЕЗУЛЬТАТ ПРОВЕРКИ ==="),console.log("Курс добавлен у пользователя:",i),console.log("ID текущего курса:",e._id),t){let i=[];"user"in t&&t.user?i=t.user.selectedCourses||[]:"selectedCourses"in t&&(i=t.selectedCourses||[]),console.log("Курсы пользователя (для проверки):",i),console.log("Содержит ли текущий ID?",i.includes(e._id))}}else b(!1),R(null),console.log("Пользователь не авторизован, курс не добавлен")}catch(e){console.error("Ошибка загрузки данных:",e),e.message?.includes("404")?h("Курс не найден"):e.message?.includes("400")?h("Неверный запрос. Проверьте ID курса."):h(e.message||"Ошибка при загрузке данных")}finally{g(!1),console.log("=== ЗАВЕРШЕНИЕ ЗАГРУЗКИ ===")}};D&&e()},[D,L]),(0,n.useEffect)(()=>{let e=async()=>{if(console.log("=== СОБЫТИЕ: userDataUpdated ==="),(0,r.isAuthenticated)()&&D&&a)try{let{userData:e,isCourseAdded:t}=await L();R(e),b(t),console.log("Данные обновлены после события:",{courseId:a._id,isCourseAdded:t})}catch(e){console.error("Ошибка обновления данных пользователя:",e)}};return window.addEventListener("userDataUpdated",e),()=>{window.removeEventListener("userDataUpdated",e)}},[D,a,L]);let F=async()=>{if(a){f(!0);try{if(!(0,r.isAuthenticated)()){alert("Требуется авторизация. Пожалуйста, войдите в систему."),q.push("/page/SignIn");return}console.log(`=== НАЧАЛО ДОБАВЛЕНИЯ КУРСА ${a._id} ===`);let{isCourseAdded:e}=await L();if(e){alert("Курс уже был добавлен ранее!"),b(!0);return}console.log("Курс не добавлен, продолжаем..."),await (0,c.addCourseToUser)(a._id),console.log("Курс добавлен успешно на сервере");let{userData:t,isCourseAdded:i}=await L();R(t),b(i),console.log("Данные пользователя обновлены после добавления курса:","Курс добавлен:",i),window.dispatchEvent(new CustomEvent("userDataUpdated",{detail:{courseId:a._id,action:"added"}})),alert("Курс успешно добавлен!")}catch(e){if(console.error("Ошибка при добавлении курса:",e),e.message?.includes("401"))alert("Требуется авторизация. Пожалуйста, войдите в систему."),q.push("/page/SignIn");else if(e.message?.includes("Курс уже был добавлен")||e.message?.includes("already added")){alert("Курс уже был добавлен ранее!");let{isCourseAdded:e}=await L();b(e)}else alert(e.message||"Ошибка при добавлении курса")}finally{f(!1),console.log("=== ЗАВЕРШЕНИЕ ДОБАВЛЕНИЯ КУРСА ===")}}},T=async()=>{if(a&&confirm("Вы уверены, что хотите удалить этот курс? Весь прогресс будет сброшен.")){j(!0);try{if(!(0,r.isAuthenticated)())throw Error("Требуется авторизация");console.log(`=== НАЧАЛО УДАЛЕНИЯ КУРСА ${a._id} ===`);try{await (0,c.resetCourseProgress)(a._id),console.log(`Прогресс курса ${a._id} сброшен`)}catch(e){console.warn(`Не удалось сбросить прогресс для курса ${a._id}:`,e)}await (0,c.removeCourseFromUser)(a._id),console.log("Курс удален успешно на сервере");let{userData:e,isCourseAdded:t}=await L();R(e),b(t),console.log("Данные пользователя обновлены после удаления курса:","Курс добавлен:",t),window.dispatchEvent(new CustomEvent("userDataUpdated",{detail:{courseId:a._id,action:"removed"}})),alert("Курс успешно удален!")}catch(e){console.error("Ошибка при удалении курса:",e),alert(e.message||"Ошибка при удаления курса")}finally{j(!1),console.log("=== ЗАВЕРШЕНИЕ УДАЛЕНИЯ КУРСА ===")}}};if((0,n.useEffect)(()=>{console.log("=== ОТЛАДКА РЕНДЕРА ===",{courseId:D,courseAdded:S,userData:C,course:a?._id,isAuth:(0,r.isAuthenticated)()})}),m)return(0,t.jsx)("div",{style:{padding:"40px",textAlign:"center"},children:(0,t.jsx)("div",{children:"Загрузка курса..."})});if(p)return(0,t.jsxs)("div",{style:{padding:"40px",textAlign:"center"},children:[(0,t.jsx)("h2",{children:"Ошибка"}),(0,t.jsx)("p",{children:p}),(0,t.jsx)(s.default,{href:"/",style:{color:"#0070f3",textDecoration:"none"},children:"Вернуться на главную"})]});if(!a)return(0,t.jsxs)("div",{style:{padding:"40px",textAlign:"center"},children:[(0,t.jsx)("h2",{children:"Курс не найден"}),(0,t.jsx)("p",{children:"Курс не существует или был удален"}),(0,t.jsx)(s.default,{href:"/",style:{color:"#0070f3",textDecoration:"none"},children:"Вернуться на главную"})]});let O=X?decodeURIComponent(X):"/img/image_9.png",J=U?decodeURIComponent(U):"#FF6B6B",P=I?decodeURIComponent(I):"58%",$=k?decodeURIComponent(k):"119%",H=E?decodeURIComponent(E):"-230px",K=B?decodeURIComponent(B):"-205px",V=["проработка всех групп мышц","тренировка суставов","улучшение циркуляции крови","упражнения заряжают бодростью","помогают противостоять стрессам"],W=(0,r.isAuthenticated)();return console.log("=== ФИНАЛЬНЫЙ СТАТУС ПЕРЕД РЕНДЕРОМ ===",{isAuth:W,courseAdded:S,courseId:a._id,courseName:a.nameRU,loading:m,userHasData:!!C}),(0,t.jsxs)("div",{className:o.default.container,children:[(0,t.jsx)(l,{courseName:a.nameRU,imageUrl:O,backgroundColor:J,imageWidth:P,imageHeight:$,imageTop:H,imageRight:K}),(0,t.jsx)(_.default,{isOpen:y,onClose:()=>N(!1),onLoginSuccess:()=>{console.log("=== ОБРАБОТЧИК УСПЕШНОЙ АВТОРИЗАЦИИ ===");let e=(0,r.isAuthenticated)();N(!1),e&&D&&(console.log("Пользователь авторизовался, проверяем курс..."),L().then(({userData:e,isCourseAdded:t})=>{R(e),b(t),console.log("Статус курса после авторизации:",t),window.dispatchEvent(new Event("authStateChanged"))}))},onOpenSignup:()=>{}}),(0,t.jsxs)("div",{className:o.default.entice,children:[(0,t.jsx)("div",{children:(0,t.jsx)("h3",{className:o.default.entice__title,children:"Подойдет для вас, если:"})}),(0,t.jsx)("div",{className:o.default.entice__disBox,children:a.fitting&&a.fitting.length>0?a.fitting.map((e,i)=>(0,t.jsxs)("div",{className:o.default.entice__dis,children:[(0,t.jsx)("p",{className:o.default.entice__numb,children:i+1}),(0,t.jsx)("p",{className:o.default.entice__text,children:e})]},i)):["Давно хотели попробовать, но не решались начать","Хотите укрепить позвоночник, избавиться от болей в спине и суставах","Ищете активность, полезную для тела и души"].map((e,i)=>(0,t.jsxs)("div",{className:o.default.entice__dis,children:[(0,t.jsx)("p",{className:o.default.entice__numb,children:i+1}),(0,t.jsx)("p",{className:o.default.entice__text,children:e})]},i))})]}),(0,t.jsxs)("div",{className:o.default.Directions,children:[(0,t.jsx)("h3",{className:o.default.Directions__title,children:"Направления"}),(0,t.jsx)("div",{className:o.default.Directions__box,children:a.directions&&a.directions.length>0?a.directions.map((e,s)=>(0,t.jsxs)("div",{className:o.default.Directions__description,children:[(0,t.jsx)(i.default,{width:26,height:26,className:o.default.Directions__img,src:"/img/Sparcle.svg",alt:"Sparcle",priority:!0}),(0,t.jsx)("p",{className:o.default.Directions__text,children:e})]},s)):(0,t.jsx)("p",{className:o.default.noDirections,children:"Направления не указаны"})})]}),(0,t.jsxs)("div",{className:o.default.motivation__main,children:[(0,t.jsx)("div",{className:o.default.motivation,children:(0,t.jsxs)("div",{className:o.default.motivation__box,children:[(0,t.jsx)("h3",{className:o.default.motivation__title,children:"Начните путь к новому телу"}),(0,t.jsx)("div",{className:o.default.motivation__text,children:V.map((e,i)=>(0,t.jsxs)("p",{children:["• ",e,i<V.length-1]},i))}),(0,t.jsx)("div",{className:o.default.motivation__but,children:m?(0,t.jsx)("div",{style:{padding:"10px",textAlign:"center"},children:(0,t.jsx)("div",{children:"Загрузка..."})}):W?S?(0,t.jsx)("div",{className:o.default.courseActions,children:(0,t.jsx)(s.default,{href:"#",className:o.default.removeCourseLink,onClick:e=>{e.preventDefault(),T()},children:v?"Удаление...":"Курс уже добавлен, Удалить?"})}):(0,t.jsx)(s.default,{href:"#",className:o.default.motivation__butLink,onClick:e=>{e.preventDefault(),F()},children:x?"Добавление...":"Добавить курс"}):(0,t.jsx)(s.default,{href:"#",className:o.default.motivation__butLink,onClick:e=>{e.preventDefault(),N(!0)},children:"Войдите, чтобы добавить курс"})})]})}),(0,t.jsx)(i.default,{width:670.18,height:390.98,className:o.default.motivation__imgSvg2,src:"/img/Vector 6084.svg",alt:"Sparcle",priority:!0}),(0,t.jsx)(i.default,{width:50,height:42.5,className:o.default.motivation__imgSvg1,src:"/img/Vector 6094.svg",alt:"Sparcle",priority:!0}),(0,t.jsx)(i.default,{width:547,height:566,className:o.default.motivation__img,src:"/img/skypro_mid23_Crouching_man_in_green_polo_shirt_and_navy_shorts__934c6a97-07c8-4c5b-9487-96389d003dfd Background Removed 2.png",alt:"Sparcle",priority:!0})]})]})}e.s(["default",()=>u],40222)}]);